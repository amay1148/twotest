<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>宝宝起名 - 生辰八字智能取名</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Noto Serif SC', serif;
            background-color: #fdfbf7;
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .ink-text {
            color: #2c2c2c;
        }
        .red-accent {
            color: #c23616;
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .traditional-border {
            border: 2px solid #c23616;
            border-radius: 8px;
            position: relative;
        }
        .traditional-border::after {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            right: 4px;
            bottom: 4px;
            border: 1px solid #c23616;
            border-radius: 4px;
            pointer-events: none;
        }
        
        .btn-primary {
            background-color: #c23616;
            color: #fff;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #a32a10;
        }
        /* Loading Animation */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #c23616;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen pb-12">
    <!-- Header -->
    <header class="bg-stone-100 border-b-4 border-red-800 py-6 mb-8 shadow-md">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-red-800 tracking-widest">国风 · 智能起名</h1>
            <p class="text-stone-600 mt-2 text-sm md:text-base">周易八字 · 五行平衡 · 诗词寓意</p>
        </div>
    </header>
    <!-- Main Content -->
    <main class="container mx-auto px-4 max-w-3xl">
        
        <!-- Input Form -->
        <section id="input-section" class="bg-white p-6 md:p-8 rounded-lg card-shadow traditional-border mb-8">
            <h2 class="text-xl font-bold text-center mb-6 text-stone-800 flex items-center justify-center">
                <span class="w-8 h-[2px] bg-red-800 mr-3"></span>
                填写宝宝信息
                <span class="w-8 h-[2px] bg-red-800 ml-3"></span>
            </h2>
            <form id="naming-form" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-stone-700 font-semibold mb-2">姓氏</label>
                        <input type="text" id="surname" placeholder="例如：李" required
                            class="w-full px-4 py-2 border border-stone-300 rounded focus:outline-none focus:border-red-800 focus:ring-1 focus:ring-red-800 bg-stone-50">
                    </div>
                    <div>
                        <label class="block text-stone-700 font-semibold mb-2">性别</label>
                        <div class="flex space-x-4">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="gender" value="boy" checked class="text-red-800 focus:ring-red-800">
                                <span>男宝宝</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" name="gender" value="girl" class="text-red-800 focus:ring-red-800">
                                <span>女宝宝</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-stone-700 font-semibold mb-2">出生日期 (公历)</label>
                        <input type="date" id="birth-date" required
                            class="w-full px-4 py-2 border border-stone-300 rounded focus:outline-none focus:border-red-800 focus:ring-1 focus:ring-red-800 bg-stone-50">
                    </div>
                    <div>
                        <label class="block text-stone-700 font-semibold mb-2">出生时辰</label>
                        <select id="birth-hour" class="w-full px-4 py-2 border border-stone-300 rounded focus:outline-none focus:border-red-800 focus:ring-1 focus:ring-red-800 bg-stone-50">
                            <option value="0">子时 (23:00-00:59)</option>
                            <option value="1">丑时 (01:00-02:59)</option>
                            <option value="3">寅时 (03:00-04:59)</option>
                            <option value="5">卯时 (05:00-06:59)</option>
                            <option value="7">辰时 (07:00-08:59)</option>
                            <option value="9">巳时 (09:00-10:59)</option>
                            <option value="11">午时 (11:00-12:59)</option>
                            <option value="13">未时 (13:00-14:59)</option>
                            <option value="15">申时 (15:00-16:59)</option>
                            <option value="17">酉时 (17:00-18:59)</option>
                            <option value="19">戌时 (19:00-20:59)</option>
                            <option value="21">亥时 (21:00-22:59)</option>
                        </select>
                    </div>
                </div>
                <div class="pt-4">
                    <button type="submit" class="w-full btn-primary py-3 rounded-md font-bold text-lg shadow-lg transform active:scale-95 transition-transform">
                        立即测算取名
                    </button>
                </div>
            </form>
        </section>
        <!-- Loading State -->
        <div id="loading" class="hidden text-center py-12">
            <div class="loader"></div>
            <p class="text-stone-600 mt-4">正在排盘推演，分析五行...</p>
        </div>
        <!-- Results Section -->
        <section id="results-section" class="hidden space-y-8">
            
            <!-- Ba Zi Analysis -->
            <div class="bg-white p-6 rounded-lg card-shadow">
                <h3 class="text-lg font-bold text-stone-800 border-b pb-2 mb-4">八字排盘</h3>
                <div class="grid grid-cols-4 gap-2 text-center">
                    <div class="bg-stone-50 p-3 rounded border border-stone-200">
                        <div class="text-xs text-stone-500 mb-1">年柱</div>
                        <div class="font-bold text-xl text-stone-800" id="year-pillar">--</div>
                    </div>
                    <div class="bg-stone-50 p-3 rounded border border-stone-200">
                        <div class="text-xs text-stone-500 mb-1">月柱</div>
                        <div class="font-bold text-xl text-stone-800" id="month-pillar">--</div>
                    </div>
                    <div class="bg-stone-50 p-3 rounded border border-stone-200">
                        <div class="text-xs text-stone-500 mb-1">日柱</div>
                        <div class="font-bold text-xl text-stone-800" id="day-pillar">--</div>
                    </div>
                    <div class="bg-stone-50 p-3 rounded border border-stone-200">
                        <div class="text-xs text-stone-500 mb-1">时柱</div>
                        <div class="font-bold text-xl text-stone-800" id="hour-pillar">--</div>
                    </div>
                </div>
                <div class="mt-6">
                    <h4 class="text-md font-semibold text-stone-700 mb-3">五行强弱分析</h4>
                    <div class="grid grid-cols-5 gap-2 text-center text-sm">
                        <div class="flex flex-col items-center">
                            <span class="mb-1">金</span>
                            <div class="w-full bg-gray-200 rounded-full h-16 relative">
                                <div id="bar-gold" class="absolute bottom-0 w-full bg-yellow-500 rounded-b-full transition-all duration-1000" style="height: 0%"></div>
                            </div>
                            <span class="mt-1" id="score-gold">0</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <span class="mb-1">木</span>
                            <div class="w-full bg-gray-200 rounded-full h-16 relative">
                                <div id="bar-wood" class="absolute bottom-0 w-full bg-green-600 rounded-b-full transition-all duration-1000" style="height: 0%"></div>
                            </div>
                            <span class="mt-1" id="score-wood">0</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <span class="mb-1">水</span>
                            <div class="w-full bg-gray-200 rounded-full h-16 relative">
                                <div id="bar-water" class="absolute bottom-0 w-full bg-blue-500 rounded-b-full transition-all duration-1000" style="height: 0%"></div>
                            </div>
                            <span class="mt-1" id="score-water">0</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <span class="mb-1">火</span>
                            <div class="w-full bg-gray-200 rounded-full h-16 relative">
                                <div id="bar-fire" class="absolute bottom-0 w-full bg-red-500 rounded-b-full transition-all duration-1000" style="height: 0%"></div>
                            </div>
                            <span class="mt-1" id="score-fire">0</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <span class="mb-1">土</span>
                            <div class="w-full bg-gray-200 rounded-full h-16 relative">
                                <div id="bar-earth" class="absolute bottom-0 w-full bg-amber-700 rounded-b-full transition-all duration-1000" style="height: 0%"></div>
                            </div>
                            <span class="mt-1" id="score-earth">0</span>
                        </div>
                    </div>
                    <div class="mt-4 bg-red-50 p-3 rounded text-sm text-red-800 border border-red-100">
                        <strong>八字喜用：</strong> <span id="favorable-element">正在计算...</span>
                        <br>
                        <span class="text-xs text-red-600/80">建议名字中包含此类五行的字，以补足先天缺失。</span>
                    </div>
                </div>
            </div>
            <!-- Name Recommendations -->
            <div class="bg-white p-6 rounded-lg card-shadow">
                <h3 class="text-lg font-bold text-stone-800 border-b pb-2 mb-4">精选好名</h3>
                <div id="names-container" class="grid grid-cols-1 gap-4">
                    <!-- Generated names will appear here -->
                </div>
                <div class="mt-6 text-center">
                     <button id="regenerate-btn" class="text-red-700 border border-red-700 px-4 py-2 rounded hover:bg-red-50 transition-colors text-sm">
                        换一批名字
                    </button>
                </div>
            </div>
        </section>
    </main>
    <footer class="text-center text-stone-500 text-xs py-8 mt-8">
        <p>⚠️ 本工具仅供娱乐与文化体验，严谨的八字排盘请咨询专业人士。</p>
    </footer>
    <script>
        // --- Constants & Data ---
        const STEMS = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
        const BRANCHES = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
        const ZODIAC = ['鼠', '牛', '虎', '兔', '龙', '蛇', '马', '羊', '猴', '鸡', '狗', '猪'];
        
        // 5 Elements Mapping
        // Metal(金), Wood(木), Water(水), Fire(火), Earth(土)
        const STEM_ELEMENTS = {
            '甲': 'wood', '乙': 'wood',
            '丙': 'fire', '丁': 'fire',
            '戊': 'earth', '己': 'earth',
            '庚': 'gold', '辛': 'gold',
            '壬': 'water', '癸': 'water'
        };
        const BRANCH_ELEMENTS = {
            '子': 'water', '亥': 'water',
            '寅': 'wood', '卯': 'wood',
            '巳': 'fire', '午': 'fire',
            '申': 'gold', '酉': 'gold',
            '辰': 'earth', '戌': 'earth', '丑': 'earth', '未': 'earth' 
        };
        const ELEMENT_CN = {
            'gold': '金', 'wood': '木', 'water': '水', 'fire': '火', 'earth': '土'
        };
        // Character Database (Simplified for Demo)
        // Ideally this would be a huge database. Here we have curated lists.
        const CHAR_DB = {
            'gold': [
                {char:'铭', pinyin:'míng', meaning:'铭记，铭刻，杰出'},
                {char:'瑞', pinyin:'ruì', meaning:'吉祥，好预兆'},
                {char:'锦', pinyin:'jǐn', meaning:'美好，华丽，前程似锦'},
                {char:'锋', pinyin:'fēng', meaning:'锐利，前锋，敢为人先'},
                {char:'钟', pinyin:'zhōng', meaning:'专注，钟情，积聚'},
                {char:'诚', pinyin:'chéng', meaning:'诚实，真诚'},
                {char:'鑫', pinyin:'xīn', meaning:'财富兴盛'},
                {char:'钧', pinyin:'jūn', meaning:'尊贵，公正'},
                {char:'钰', pinyin:'yù', meaning:'珍宝，坚硬'},
                {char:'承', pinyin:'chéng', meaning:'承担，继承'},
                {char:'诗', pinyin:'shī', meaning:'诗意，美好'},
                {char:'悦', pinyin:'yuè', meaning:'喜悦，快乐'},
                {char:'晨', pinyin:'chén', meaning:'早晨，希望'},
                {char:'书', pinyin:'shū', meaning:'书香，知识'}
            ],
            'wood': [
                {char:'林', pinyin:'lín', meaning:'生命力旺盛，群体'},
                {char:'森', pinyin:'sēn', meaning:'繁盛，稳重'},
                {char:'梓', pinyin:'zǐ', meaning:'故乡，生机勃勃'},
                {char:'栋', pinyin:'dòng', meaning:'栋梁之才'},
                {char:'松', pinyin:'sōng', meaning:'坚韧，长寿'},
                {char:'柏', pinyin:'bǎi', meaning:'细心，坚强'},
                {char:'艺', pinyin:'yì', meaning:'才艺，艺术'},
                {char:'若', pinyin:'ruò', meaning:'美好，像'},
                {char:'英', pinyin:'yīng', meaning:'英明，杰出'},
                {char:'茂', pinyin:'mào', meaning:'繁荣，旺盛'},
                {char:'楚', pinyin:'chǔ', meaning:'清晰，鲜艳'},
                {char:'梦', pinyin:'mèng', meaning:'梦想，美好'},
                {char:'语', pinyin:'yǔ', meaning:'文采，表达'},
                {char:'嘉', pinyin:'jiā', meaning:'美好，赞许'}
            ],
            'water': [
                {char:'泽', pinyin:'zé', meaning:'恩泽，仁慈'},
                {char:'涵', pinyin:'hán', meaning:'包容，修养'},
                {char:'浩', pinyin:'hào', meaning:'浩大，广阔'},
                {char:'润', pinyin:'rùn', meaning:'滋润，温润'},
                {char:'博', pinyin:'bó', meaning:'博大，渊博'},
                {char:'渊', pinyin:'yuān', meaning:'深远，学识深'},
                {char:'源', pinyin:'yuán', meaning:'源泉，根本'},
                {char:'洋', pinyin:'yáng', meaning:'广阔，盛大'},
                {char:'洁', pinyin:'jié', meaning:'纯洁，高尚'},
                {char:'清', pinyin:'qīng', meaning:'清澈，清廉'},
                {char:'溪', pinyin:'xī', meaning:'清澈，绵长'},
                {char:'云', pinyin:'yún', meaning:'高远，自由'},
                {char:'雨', pinyin:'yǔ', meaning:'恩泽，滋润'},
                {char:'宏', pinyin:'hóng', meaning:'宏大，宏伟'}
            ],
            'fire': [
                {char:'炎', pinyin:'yán', meaning:'热情，兴盛'},
                {char:'煜', pinyin:'yù', meaning:'照耀，光辉'},
                {char:'灿', pinyin:'càn', meaning:'灿烂，光明'},
                {char:'灵', pinyin:'líng', meaning:'灵气，机敏'},
                {char:'烨', pinyin:'yè', meaning:'光辉，显赫'},
                {char:'烁', pinyin:'shuò', meaning:'闪耀，卓越'},
                {char:'伦', pinyin:'lún', meaning:'伦理，次序'},
                {char:'明', pinyin:'míng', meaning:'光明，明理'},
                {char:'俊', pinyin:'jùn', meaning:'英俊，才智'},
                {char:'宁', pinyin:'níng', meaning:'安宁，平和 (火土兼)'},
                {char:'昊', pinyin:'hào', meaning:'广大，天空'},
                {char:'智', pinyin:'zhì', meaning:'智慧，聪明'},
                {char:'昕', pinyin:'xīn', meaning:'黎明，希望'},
                {char:'晴', pinyin:'qíng', meaning:'阳光，开朗'}
            ],
            'earth': [
                {char:'坤', pinyin:'kūn', meaning:'大地，宽厚'},
                {char:'磊', pinyin:'lěi', meaning:'光明磊落'},
                {char:'宇', pinyin:'yǔ', meaning:'宇宙，风度'},
                {char:'轩', pinyin:'xuān', meaning:'高昂，气度'},
                {char:'远', pinyin:'yuǎn', meaning:'长远，志向'},
                {char:'安', pinyin:'ān', meaning:'安定，平安'},
                {char:'辰', pinyin:'chén', meaning:'时光，星辰'},
                {char:'逸', pinyin:'yì', meaning:'安逸，超凡'},
                {char:'勋', pinyin:'xūn', meaning:'功勋，成就'},
                {char:'伟', pinyin:'wěi', meaning:'伟大，宏大'},
                {char:'佑', pinyin:'yòu', meaning:'保佑，帮助'},
                {char:'山', pinyin:'shān', meaning:'稳重，靠山'},
                {char:'峰', pinyin:'fēng', meaning:'顶峰，杰出'},
                {char:'岩', pinyin:'yán', meaning:'坚强，不屈'}
            ]
        };
        // --- Helper Functions ---
        // 1. Calculate Ba Zi (Simplified Algorithm)
        // Note: Accurate Solar Terms (Jie Qi) calculation is very complex. 
        // This uses a simplified method for demonstration purposes.
        function calculateBaZi(dateStr, hour) {
            const date = new Date(dateStr);
            const year = date.getFullYear();
            const month = date.getMonth() + 1; // 1-12
            const day = date.getDate();
            
            // Year Pillar
            // 1900 was Geng-Zi (Metal Rat). Formula: (Year - 4) % 60 or similar
            // Standard formula: (Year - 3) % 60. If result is 1 -> Jia-Zi
            const yearOffset = (year - 3) % 60; 
            const yearStemIndex = (yearOffset - 1) % 10;
            const yearBranchIndex = (yearOffset - 1) % 12;
            const yearPillar = STEMS[(yearStemIndex + 10) % 10] + BRANCHES[(yearBranchIndex + 12) % 12];
            // Month Pillar (Approximation using "Wu Hu Dun")
            // Depends on Year Stem and Month.
            // This is a simplified lookup. Real Ba Zi uses Solar Terms.
            // We will approximate by saying Month 1 (Feb approx) starts the cycle.
            // Simplified: Month Starts from Yin(Tiger) usually around Feb 4th.
            // Let's just map standard Gregorian months to Branches roughly for demo.
            // Feb -> Yin, Mar -> Mao...
            const monthBranchIndex = (month + 12) % 12; // Roughly mapping standard months
            // Wu Hu Dun: Determine Month Stem from Year Stem
            // 甲己之年丙作首...
            const yearStemChar = STEMS[(yearStemIndex + 10) % 10];
            let monthStemStartIdx = 0;
            if (['甲', '己'].includes(yearStemChar)) monthStemStartIdx = 2; // Bing
            if (['乙', '庚'].includes(yearStemChar)) monthStemStartIdx = 4; // Wu
            if (['丙', '辛'].includes(yearStemChar)) monthStemStartIdx = 6; // Geng
            if (['丁', '壬'].includes(yearStemChar)) monthStemStartIdx = 8; // Ren
            if (['戊', '癸'].includes(yearStemChar)) monthStemStartIdx = 0; // Jia
            
            // Adjust for "month index" relative to Tiger (1st month of lunar)
            // Approximate: Gregorian Feb is month 1.
            let lunarMonthApprox = month - 2; 
            if (lunarMonthApprox < 0) lunarMonthApprox += 12;
            
            const monthStemIndex = (monthStemStartIdx + lunarMonthApprox) % 10;
            // Feb is Yin (Tiger) -> index 2 in BRANCHES
            const monthBranchRealIndex = (2 + lunarMonthApprox) % 12; 
            const monthPillar = STEMS[monthStemIndex] + BRANCHES[monthBranchRealIndex];
            // Day Pillar
            // Calculating Day Pillar accurately requires a reference date.
            // Base: 1900-01-01 was Jia-Xu (Wood Dog).
            // Calculate days diff.
            const baseDate = new Date('1900-01-01');
            const diffTime = Math.abs(date - baseDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            // 1900-01-01 is Jia(0)-Xu(10). Offset = 10 (number in cycle 1-60)
            // Cycle: Jia-Zi(1) ... Gui-Hai(60)
            // Jia-Xu is #11 in the 60 cycle.
            const baseOffset = 10; 
            const dayCycleIdx = (baseOffset + diffDays) % 60;
            const dayStemIndex = (dayCycleIdx % 10);
            const dayBranchIndex = (dayCycleIdx % 12);
            const dayPillar = STEMS[dayStemIndex] + BRANCHES[dayBranchIndex];
            // Hour Pillar
            // Determined by Day Stem and Hour Branch.
            // Hour Branch is fixed by time (00:00 is Zi).
            // Hour input from select is the starting hour (0, 1, 3, etc.)
            let h = parseInt(hour);
            let hourBranchIndex = 0;
            if (h >= 23 || h < 1) hourBranchIndex = 0; // Zi
            else if (h >= 1 && h < 3) hourBranchIndex = 1; // Chou
            else hourBranchIndex = Math.floor((h + 1) / 2);
            // Wu Shu Dun: Determine Hour Stem from Day Stem
            // 甲己还加甲...
            const dayStemChar = STEMS[dayStemIndex];
            let hourStemStartIdx = 0;
            if (['甲', '己'].includes(dayStemChar)) hourStemStartIdx = 0; // Jia
            if (['乙', '庚'].includes(dayStemChar)) hourStemStartIdx = 2; // Bing
            if (['丙', '辛'].includes(dayStemChar)) hourStemStartIdx = 4; // Wu
            if (['丁', '壬'].includes(dayStemChar)) hourStemStartIdx = 6; // Geng
            if (['戊', '癸'].includes(dayStemChar)) hourStemStartIdx = 8; // Ren
            
            const hourStemIndex = (hourStemStartIdx + hourBranchIndex) % 10;
            const hourPillar = STEMS[hourStemIndex] + BRANCHES[hourBranchIndex];
            return {
                year: yearPillar,
                month: monthPillar,
                day: dayPillar,
                hour: hourPillar,
                components: [
                    STEMS[(yearStemIndex + 10) % 10], BRANCHES[(yearBranchIndex + 12) % 12],
                    STEMS[monthStemIndex], BRANCHES[monthBranchRealIndex],
                    STEMS[dayStemIndex], BRANCHES[dayBranchIndex],
                    STEMS[hourStemIndex], BRANCHES[hourBranchIndex]
                ]
            };
        }
        // 2. Analyze Elements
        function analyzeElements(baZiComponents) {
            let counts = { 'gold': 0, 'wood': 0, 'water': 0, 'fire': 0, 'earth': 0 };
            
            baZiComponents.forEach(char => {
                if (STEM_ELEMENTS[char]) counts[STEM_ELEMENTS[char]]++;
                if (BRANCH_ELEMENTS[char]) counts[BRANCH_ELEMENTS[char]]++;
            });
            let total = 8;
            let scores = {};
            let minScore = 100;
            let weakestElement = '';
            for (let el in counts) {
                let score = (counts[el] / total) * 100;
                scores[el] = score;
                if (counts[el] < minScore) {
                    minScore = counts[el];
                    weakestElement = el;
                }
            }
            
            // Find missing elements (count 0)
            let missing = [];
            for (let el in counts) {
                if (counts[el] === 0) missing.push(el);
            }
            return { counts, scores, missing, weakest: weakestElement };
        }
        // 3. Generate Names
        function generateNames(surname, elementAnalysis, gender) {
            let suggestions = [];
            const count = 6;
            
            // Strategy:
            // 1. Prioritize missing elements.
            // 2. Then prioritize weak elements.
            // 3. If balanced, use lucky elements (producing cycle).
            
            let targetElements = [];
            if (elementAnalysis.missing.length > 0) {
                targetElements = [...elementAnalysis.missing];
            } else {
                // Find bottom 2 weakest
                let sorted = Object.keys(elementAnalysis.counts).sort((a,b) => elementAnalysis.counts[a] - elementAnalysis.counts[b]);
                targetElements = [sorted[0], sorted[1]];
            }
            // Helper to get random char from DB
            const getChar = (elem) => {
                const list = CHAR_DB[elem];
                return list[Math.floor(Math.random() * list.length)];
            };
            for (let i = 0; i < count; i++) {
                // Pick two elements to combine (can be same)
                let elem1 = targetElements[i % targetElements.length];
                let elem2 = targetElements[(i + 1) % targetElements.length]; // Cycle through
                // Random chance to mix in a generically "good" element like Wood or Earth if not forbidden
                if (Math.random() > 0.7) {
                    elem2 = ['wood', 'earth', 'water'][Math.floor(Math.random() * 3)];
                }
                let char1 = getChar(elem1);
                let char2 = getChar(elem2);
                // Avoid duplicate chars in one name
                while (char1.char === char2.char) {
                    char2 = getChar(elem2);
                }
                suggestions.push({
                    name: surname + char1.char + char2.char,
                    pinyin: char1.pinyin + ' ' + char2.pinyin,
                    desc: `
                        <span class="font-bold text-${getColor(elem1)}-600">${char1.char}</span>(${ELEMENT_CN[elem1]})：${char1.meaning}<br>
                        <span class="font-bold text-${getColor(elem2)}-600">${char2.char}</span>(${ELEMENT_CN[elem2]})：${char2.meaning}
                    `,
                    tags: [ELEMENT_CN[elem1], ELEMENT_CN[elem2]]
                });
            }
            return suggestions;
        }
        function getColor(element) {
            const map = { 'gold': 'yellow', 'wood': 'green', 'water': 'blue', 'fire': 'red', 'earth': 'amber' };
            return map[element] || 'gray';
        }
        // --- Event Listeners ---
        document.getElementById('naming-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const surname = document.getElementById('surname').value;
            const date = document.getElementById('birth-date').value;
            const hour = document.getElementById('birth-hour').value;
            const gender = document.querySelector('input[name="gender"]:checked').value;
            if(!surname || !date) return;
            // Show Loader
            document.getElementById('input-section').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            setTimeout(() => {
                // 1. Calc Ba Zi
                const bazi = calculateBaZi(date, hour);
                
                // 2. Analyze
                const analysis = analyzeElements(bazi.components);
                // 3. Generate Names
                const names = generateNames(surname, analysis, gender);
                // 4. Render Results
                renderResults(bazi, analysis, names);
                // Transition UI
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('results-section').classList.remove('hidden');
                document.getElementById('input-section').classList.remove('hidden'); // Show form again below or keep hidden? Let's keep it hidden to focus on results, or move results up. 
                // Actually, let's hide input to make it clean, user can reload or add a "Back" button. 
                // Or better: show everything.
                document.getElementById('input-section').classList.remove('hidden');
                
                // Scroll to results
                document.getElementById('results-section').scrollIntoView({ behavior: 'smooth' });
            }, 1200); // Fake delay for effect
        });
        document.getElementById('regenerate-btn').addEventListener('click', function() {
             // Re-trigger generation with existing data
             // We need to store the last used data or just re-read form
             // For simplicity, just re-submit the form logic without UI transition
             const surname = document.getElementById('surname').value;
             const date = document.getElementById('birth-date').value;
             const hour = document.getElementById('birth-hour').value;
             const gender = document.querySelector('input[name="gender"]:checked').value;
             
             const bazi = calculateBaZi(date, hour);
             const analysis = analyzeElements(bazi.components);
             const names = generateNames(surname, analysis, gender);
             
             const container = document.getElementById('names-container');
             container.innerHTML = ''; // Clear
             names.forEach(n => {
                const card = createNameCard(n);
                container.appendChild(card);
             });
        });
        function renderResults(bazi, analysis, names) {
            // Set Pillars
            document.getElementById('year-pillar').innerText = bazi.year;
            document.getElementById('month-pillar').innerText = bazi.month;
            document.getElementById('day-pillar').innerText = bazi.day;
            document.getElementById('hour-pillar').innerText = bazi.hour;
            // Set Bars
            document.getElementById('bar-gold').style.height = analysis.scores.gold + '%';
            document.getElementById('bar-wood').style.height = analysis.scores.wood + '%';
            document.getElementById('bar-water').style.height = analysis.scores.water + '%';
            document.getElementById('bar-fire').style.height = analysis.scores.fire + '%';
            document.getElementById('bar-earth').style.height = analysis.scores.earth + '%';
            document.getElementById('score-gold').innerText = analysis.counts.gold;
            document.getElementById('score-wood').innerText = analysis.counts.wood;
            document.getElementById('score-water').innerText = analysis.counts.water;
            document.getElementById('score-fire').innerText = analysis.counts.fire;
            document.getElementById('score-earth').innerText = analysis.counts.earth;
            // Recommendation Text
            let favText = '';
            if (analysis.missing.length > 0) {
                favText = '五行缺 ' + analysis.missing.map(e => ELEMENT_CN[e]).join('、') + '。';
            } else {
                favText = '五行俱全。弱项为 ' + ELEMENT_CN[analysis.weakest] + '。';
            }
            document.getElementById('favorable-element').innerText = favText + ' 宜补：' + (analysis.missing.length > 0 ? analysis.missing.map(e => ELEMENT_CN[e]).join('') : ELEMENT_CN[analysis.weakest]);
            // Render Names
            const container = document.getElementById('names-container');
            container.innerHTML = '';
            names.forEach(n => {
                const card = createNameCard(n);
                container.appendChild(card);
            });
        }
        function createNameCard(n) {
            const div = document.createElement('div');
            div.className = 'border border-stone-200 rounded p-4 flex items-start justify-between hover:bg-stone-50 transition-colors';
            div.innerHTML = `
                <div>
                    <div class="flex items-end space-x-3 mb-1">
                        <h4 class="text-2xl font-bold text-stone-800 tracking-widest">${n.name}</h4>
                        <span class="text-stone-500 text-sm italic">${n.pinyin}</span>
                    </div>
                    <p class="text-sm text-stone-600 mt-2 leading-relaxed">${n.desc}</p>
                </div>
                <div class="flex flex-col space-y-1">
                    ${n.tags.map(t => `<span class="text-xs px-2 py-1 rounded bg-stone-200 text-stone-600">${t}</span>`).join('')}
                </div>
            `;
            return div;
        }
        
        // Set default date to today
        document.getElementById('birth-date').valueAsDate = new Date();
    </script>
</body>
</html>